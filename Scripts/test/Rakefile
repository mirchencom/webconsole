require 'shellwords'

WEB_CONSOLE_TESTS_DIRECTORY = File.expand_path(File.dirname(__FILE__))

task :default => [:xcunit, :web_console, :gems, :plugins]

task :long => [:default, :web_console_long]

task :web_console => ['web_console:tests']
task :web_console_long => ['web_console_long:tests']
task :xcunit => ['xcunit:tests']
task :gems => ['gems:tests']
task :plugins => ['plugins:tests']


namespace :gems do

  WEBCONSOLE_GEM_TESTS_RAKEFILE = File.join(WEB_CONSOLE_TESTS_DIRECTORY, "../../Web Console/webconsole/test/Rakefile")
  load WEBCONSOLE_GEM_TESTS_RAKEFILE

  task :tests => [:test_webconsole]

  task :test_webconsole => ['webconsole:clean_up']

end


namespace :plugins do

  WCACK_TEST_RAKEFILE = File.expand_path(File.join(WEB_CONSOLE_TESTS_DIRECTORY, "../..", "Web Console", "Ack", "wcack", "test", "Rakefile"))
  load WCACK_TEST_RAKEFILE

  task :tests => [:test_wcack]

  task :test_wcack => ['wcack:tests']

end


namespace :xcunit do

  task :tests => ['test_xcunit']

  task :test_xcunit do
    XCODEBUILD_SCHEME = "Web Console"
    XCODEBUILD_PROJECT_FILE = File.expand_path(File.join(WEB_CONSOLE_TESTS_DIRECTORY, "../../Web Console/Web Console.xcodeproj"))
    sh "xcodebuild test -scheme #{Shellwords.escape(XCODEBUILD_SCHEME)} -project #{Shellwords.escape(XCODEBUILD_PROJECT_FILE)}"
  end

end


namespace :web_console do

  task :tests => [:clean_up]

  task :test_web_console do
    WEB_CONSOLE_TESTS_FILE = File.join(WEB_CONSOLE_TESTS_DIRECTORY, "tc_web_console.rb")
    ruby Shellwords.escape(WEB_CONSOLE_TESTS_FILE)
  end

  task :clean_up => [:test_web_console] do
    DATA_DIRECTORY = File.join(WEB_CONSOLE_TESTS_DIRECTORY, "data")
    QUIT_APPLESCRIPT_FILE = File.join(DATA_DIRECTORY, "quit.applescript")
    sh "osascript #{Shellwords.escape(QUIT_APPLESCRIPT_FILE)}"
  end

end


namespace :web_console_long do

  task :tests => [:clean_up]

  task :test_web_console_long do
    WEB_CONSOLE_TESTS_LONG_FILE = File.join(WEB_CONSOLE_TESTS_DIRECTORY, "tc_web_console_long.rb")
    ruby Shellwords.escape(WEB_CONSOLE_TESTS_LONG_FILE)
  end

  task :clean_up => [:test_web_console_long] do
    DATA_DIRECTORY = File.join(WEBCONSOLE_TESTS_DIRECTORY, "data")
    QUIT_APPLESCRIPT_FILE = File.join(DATA_DIRECTORY, "quit.applescript")
    sh "osascript #{Shellwords.escape(QUIT_APPLESCRIPT_FILE)}"
  end

end
