require 'shellwords'

task :default => [:xcunit, :ruby]

task :long => [:xcunit, :ruby_long]
task :xcunit => ['xcunit:tests']
task :ruby => [:web_console, :gems, :plugins]

task :ruby_long => [:web_console_long, :gems, :plugins]
task :web_console => ['web_console:tests']
task :web_console_long => ['web_console:tests_long']
task :gems => ['gems:tests']
task :plugins => ['plugins:tests']


namespace :gems do

  webconsole_gem_tests_rakefile = File.join(File.dirname(__FILE__), "../../Web Console/webconsole/test/Rakefile")
  load webconsole_gem_tests_rakefile

  task :tests => [:test_webconsole]

  task :test_webconsole => ['webconsole:clean_up']

end


namespace :plugins do

  wcack_test_rakefile = File.join(File.dirname(__FILE__), "../..", "Web Console", "Ack", "wcack", "test", "Rakefile")
  load wcack_test_rakefile

  task :tests => [:test_wcack]

  task :test_wcack => ['wcack:tests']

end


namespace :xcunit do

  task :tests => ['test_xcunit']

  task :test_xcunit do
    xcodebuild_scheme = "Web Console"
    xcodebuild_project_file = File.join(File.dirname(__FILE__), "../../Web Console/Web Console.xcodeproj")
    sh "xcodebuild test -scheme #{Shellwords.escape(xcodebuild_scheme)} -project #{Shellwords.escape(xcodebuild_project_file)}"
  end

end


namespace :web_console do

  task :tests => [:clean_up]
  task :tests_long => [:test_web_console_long, :tests]

  task :clean_up => [:test_web_console] do
    data_directory = File.join(File.dirname(__FILE__), "data")
    quit_applescript_file = File.join(data_directory, "quit.applescript")
    sh "osascript #{Shellwords.escape(quit_applescript_file)}"
  end

  task :test_web_console do
    web_console_tests_file = File.join(File.dirname(__FILE__), "tc_web_console.rb")
    ruby Shellwords.escape(web_console_tests_file)
  end

  task :test_web_console_long do
    web_console_tests_long_file = File.join(File.dirname(__FILE__), "tc_web_console_long.rb")
    ruby Shellwords.escape(web_console_tests_long_file)
  end

end





