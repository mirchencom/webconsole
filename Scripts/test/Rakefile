require 'shellwords'

TESTS_DIRECTORY = File.expand_path(File.dirname(__FILE__))

DATA_DIRECTORY = File.join(TESTS_DIRECTORY, "data")
QUIT_APPLESCRIPT_FILE = File.join(DATA_DIRECTORY, "quit.applescript")

XCODEBUILD_SCHEME = "Web Console"
XCODEBUILD_PROJECT_FILE = File.expand_path(File.join(TESTS_DIRECTORY, "../../Web Console/Web Console.xcodeproj"))

WEBCONSOLE_TESTS_FILE = File.join(TESTS_DIRECTORY, "tc_web_console.rb")
WEBCONSOLE_GEM_TESTS_FILE = File.join(TESTS_DIRECTORY, "../../Web Console/webconsole/test/tc_webconsole.rb")

task :default => [:test]

task :test do
  sh "xcodebuild test -scheme #{Shellwords.escape(XCODEBUILD_SCHEME)} -project #{Shellwords.escape(XCODEBUILD_PROJECT_FILE)}"
  ruby Shellwords.escape(WEBCONSOLE_TESTS_FILE)
  ruby Shellwords.escape(WEBCONSOLE_GEM_TESTS_FILE)
  sh "osascript #{Shellwords.escape(QUIT_APPLESCRIPT_FILE)}"
end